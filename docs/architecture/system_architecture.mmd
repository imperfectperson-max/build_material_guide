graph TB
    subgraph "Client Layer"
        WEB["üåê Web Dashboard<br/>React + Tailwind CSS<br/>Recharts<br/><br/>Features:<br/>‚Ä¢ Material Search<br/>‚Ä¢ Price Comparison<br/>‚Ä¢ Forecast Visualization<br/>‚Ä¢ PWA Support"]
        MOBILE["üì± Mobile App<br/>Flutter + Hive<br/><br/>Features:<br/>‚Ä¢ Barcode Scanning<br/>‚Ä¢ Geolocation<br/>‚Ä¢ Offline Storage<br/>‚Ä¢ Push Notifications"]
    end

    subgraph "API Gateway & Load Balancing"
        LB["‚ö° Fly.io Load Balancer<br/><br/>‚Ä¢ HTTPS/TLS Termination<br/>‚Ä¢ DDoS Protection<br/>‚Ä¢ Health Checks<br/>‚Ä¢ Geographic Routing"]
    end

    subgraph "Backend API Layer"
        API["üîß REST API<br/>Node.js + Express<br/><br/>‚Ä¢ JWT Authentication<br/>‚Ä¢ Rate Limiting<br/>‚Ä¢ Input Validation<br/>‚Ä¢ Security Headers"]
    end

    subgraph "Caching Layer"
        REDIS["‚ö° Redis Cloud<br/><br/>L1 Cache: Prices (1hr TTL)<br/>L2 Cache: Forecasts (6hr TTL)<br/>JWT Blacklist<br/>Rate Limiting Counters<br/><br/>Target: >70% Hit Rate<br/>Response: <50ms"]
    end

    subgraph "Application Services"
        AUTH["üîê Authentication<br/>Service<br/><br/>‚Ä¢ User Registration<br/>‚Ä¢ Login/Logout<br/>‚Ä¢ JWT Generation<br/>‚Ä¢ RBAC"]
        PRICE["üí∞ Price<br/>Service<br/><br/>‚Ä¢ Material Search<br/>‚Ä¢ Price Comparison<br/>‚Ä¢ Historical Data<br/>‚Ä¢ Anomaly Detection"]
        ML["ü§ñ ML Inference<br/>Service<br/><br/>‚Ä¢ LSTM<br/>‚Ä¢ Prophet<br/>‚Ä¢ XGBoost<br/>‚Ä¢ Random Forest<br/>‚Ä¢ Ensemble"]
        SCRAPER["üï∑Ô∏è Data Collection<br/>Service<br/><br/>‚Ä¢ Web Scraping<br/>‚Ä¢ PDF/OCR<br/>‚Ä¢ Data Validation<br/>‚Ä¢ Scheduled Jobs"]
    end

    subgraph "Data Storage Layer"
        PG[("üóÑÔ∏è PostgreSQL<br/>Supabase<br/><br/>Tables:<br/>‚Ä¢ users<br/>‚Ä¢ materials<br/>‚Ä¢ prices<br/>‚Ä¢ suppliers<br/>‚Ä¢ forecasts<br/>‚Ä¢ favorites")]
        HIVE[("üì¶ Hive DB<br/>Mobile Offline<br/><br/>‚Ä¢ Cached Prices<br/>‚Ä¢ Favorites<br/>‚Ä¢ Search History")]
    end

    subgraph "ML Training Infrastructure"
        KAGGLE["‚òÅÔ∏è Kaggle GPU<br/>Tesla P100<br/><br/>‚Ä¢ Model Training<br/>‚Ä¢ Hyperparameter Tuning<br/>‚Ä¢ Model Evaluation<br/>30hrs/week free"]
        MODELS["üìä Model Registry<br/><br/>‚Ä¢ LSTM v1.0<br/>‚Ä¢ Prophet v1.0<br/>‚Ä¢ XGBoost v1.0<br/>‚Ä¢ Random Forest v1.0<br/><br/>Metrics: MAE, RMSE, MAPE"]
    end

    subgraph "External Systems"
        SUPPLIERS["üè™ Supplier Websites<br/><br/>‚Ä¢ Builders Warehouse<br/>‚Ä¢ Cashbuild<br/>‚Ä¢ Makro<br/>‚Ä¢ 10+ SA Suppliers"]
        OCR["üìÑ OCR Service<br/><br/>‚Ä¢ PDF Extraction<br/>‚Ä¢ Tesseract OCR<br/>‚Ä¢ Text Processing"]
        GEO["üìç Geolocation<br/><br/>‚Ä¢ PostGIS<br/>‚Ä¢ Distance Calc<br/>‚Ä¢ Nearby Search"]
    end

    %% Client to Gateway
    WEB -->|"HTTPS<br/>JSON"| LB
    MOBILE -->|"HTTPS<br/>JSON"| LB
    
    %% Gateway to API
    LB --> API
    
    %% API to Cache and Services
    API -->|"Check Cache<br/>First"| REDIS
    API --> AUTH
    API --> PRICE
    API --> ML
    
    %% Cache to Database
    REDIS -.->|"Cache Miss<br/>~150ms"| PG
    
    %% Services to Database
    AUTH --> PG
    PRICE --> PG
    ML --> MODELS
    SCRAPER --> PG
    
    %% Scraper to External
    SCRAPER --> SUPPLIERS
    SCRAPER --> OCR
    
    %% Mobile to Local Storage
    MOBILE -.->|"Offline<br/>Sync"| HIVE
    
    %% ML Training
    KAGGLE -->|"Train<br/>Weekly"| MODELS
    MODELS -.->|"Deploy<br/>Models"| ML
    
    %% Price to Geolocation
    PRICE --> GEO

    %% Styling
    classDef client fill:#61dafb,stroke:#333,stroke-width:2px,color:#000
    classDef api fill:#68a063,stroke:#333,stroke-width:2px,color:#fff
    classDef cache fill:#DC382D,stroke:#333,stroke-width:2px,color:#fff
    classDef db fill:#336791,stroke:#333,stroke-width:2px,color:#fff
    classDef ml fill:#20BEFF,stroke:#333,stroke-width:2px,color:#000
    classDef external fill:#FFA500,stroke:#333,stroke-width:2px,color:#000
    
    class WEB,MOBILE client
    class API,AUTH,PRICE,ML,SCRAPER,LB api
    class REDIS cache
    class PG,HIVE db
    class KAGGLE,MODELS ml
    class SUPPLIERS,OCR,GEO external
